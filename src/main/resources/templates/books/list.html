<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Books List</title>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
        }
        table, th, td {
            border: 1px solid black;
        }
        th, td {
            padding: 10px;
            text-align: left;
        }
        th {
            background-color: #3498db;
            color: white;
        }
        .search-btn {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px;
            cursor: pointer;
            margin-bottom: 20px;
            border-radius: 5px;
        }
		/* Styling for the search form */
		       .search-box {
		           margin: 20px;
		       }
		       .search-box input {
		           padding: 10px;
		           font-size: 16px;
		       }
		       .search-box button {
		           padding: 10px 20px;
		           font-size: 16px;
		           background-color: #3498db;
		           color: white;
		           border: none;
		           border-radius: 5px;
		           cursor: pointer;
		       }
		       .search-box button:hover {
		           background-color: #2980b9;
		       }
			   .search-results {
			              margin-top: 10px;
			          }
			          .search-results div {
			              padding: 5px;
			              border-bottom: 1px solid #ccc;
			          }
    </style>
</head>
<body>
	
	   <script>
	           // Function to handle search input and send AJAX request
	           function searchBooks() {
	               const searchTerm = document.getElementById("searchTerm").value;
	               
	               // Send AJAX request only if searchTerm is not empty
	               if (searchTerm.length >= 0) {
	                   const xhr = new XMLHttpRequest();
	                   xhr.open("POST", "/books/search?searchTerm=" + searchTerm, true);
	                   xhr.onload = function () {
	                       if (xhr.status === 200) {
								const resultsContainer = document.getElementById("searchResults");
								resultsContainer.innerHTML = "";  // Clear the old results
	                           // Replace the search results with returned Thymeleaf-rendered HTML
	                           resultsContainer.innerHTML = xhr.responseText;
							   
							   // Re-set the input value to preserve it after the update
							   document.getElementById("searchTerm").value = searchTerm;

			                   // Keep the focus on the search input field
			                   document.getElementById("searchTerm").focus();
	                       }
	                   };
	                   xhr.send();
	               } else {
	                   // Clear search results if input is empty
	                   document.getElementById("searchResults").innerHTML = "";
	               }
	           }
	       </script>

    
	<!-- Div to display search results -->
	  <div id="searchResults" class="search-results">
		<!-- Search form (input box and button) -->
		<h1>Books List</h1>
		<script>
			document.getElementById("searchTerm").innerHTML = searchTerm;
		</script>
			   <div class="search-box">
			       <form th:action="@{/books/search}" method="post">
			           <input type="text" id="searchTerm" name="searchTerm" placeholder="Enter book title" onkeyup="searchBooks()">
			           <button type="submit">Search</button>
			       </form>
			   </div>
			   
		  <!-- Table to Display Books -->
		      <table>
		          <thead>
		              <tr>
		                  <th>ID</th>
		                  <th>Title</th>
		                  <th>Author</th>
		                  <th>Available</th>
		              </tr>
		          </thead>
		          <tbody>
		              <tr th:each="book : ${books}">
		                  <td th:text="${book.id}"></td>
		                  <td th:text="${book.title}"></td>
		                  <td th:text="${book.author}"></td>
		                  <td th:text="${book.available ? 'Yes' : 'No'}"></td>
		              </tr>
		          </tbody>
		      </table> 
	<form class="search-box" th:action="@{/home}" method="get">
	           <button type="submit">Back to Home</button>
	       </form>
	  </div>
    
</body>
</html>